---
title: "Electron + React + TypeScript ã®é–‹ç™ºç’°å¢ƒæ§‹ç¯‰"
emoji: "ğŸš€"
type: "tech"
topics:
  - "electron"
  - "react"
  - "typescript"
  - "webpack"
published: true
published_at: "2021-04-29 13:55"
---

# ã¯ã˜ã‚ã«

[React](https://ja.reactjs.org/) ã¨ [TypeScript](https://www.typescriptlang.org/) ã§ã¤ãã‚‹ [Electron](https://www.electronjs.org/) ã‚¢ãƒ—ãƒªã®ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã™ã€‚
ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã€ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã¨ã‚‚ã«ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰å¯èƒ½ãªé–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚

https://github.com/sprout2000/electron-react-ts#readme

# å‰æ

[Node.js](https://nodejs.org/en/) ã¨ [Git Bash](https://git-scm.com/)ï¼ˆã‚‚ã—ãã¯ä½•ã‚‰ã‹ã® UNIX ã‚·ã‚§ãƒ«ï¼‰ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç”¨ã®ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰ã‚’ä½œæˆã—ã€ãã®ä¸­ã§å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚„è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚

## âš™ï¸ Node.js ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦åˆæœŸåŒ–

`npm` ã‚³ãƒãƒ³ãƒ‰ã¯ Node.js ã«åŒæ¢±ã•ã‚Œã¦ã„ã¾ã™ã€‚

- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã®ä½œæˆã¨ç§»å‹•

```shell:bash
$ mkdir myapp
$ cd myapp
```

- Node.js ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦åˆæœŸåŒ–

```shell:bash
npm init --yes
```

## ğŸ“ æƒ³å®šã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```shell:bash
% tree -a -I 'node_modules'
.
â”œâ”€â”€ dist
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ src
â”‚Â Â  â”œâ”€â”€ main.ts
â”‚Â Â  â”œâ”€â”€ preload.ts
â”‚Â Â  â””â”€â”€ web
â”‚Â Â      â”œâ”€â”€ App.css
â”‚Â Â      â”œâ”€â”€ App.tsx
â”‚Â Â      â”œâ”€â”€ index.html
â”‚Â Â      â””â”€â”€ index.tsx
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tsconfig.node.json
â””â”€â”€ webpack.config.ts

3 directories, 11 files
```

- **`dist/`**: webpack ã®å‡ºåŠ›å…ˆãƒ•ã‚©ãƒ«ãƒ€
- **`src/main.ts`**: ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã®ã‚¨ãƒ³ãƒˆãƒªãƒ•ã‚¡ã‚¤ãƒ«
- **`src/preload.ts`**: ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- **`src/web/`**: ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ (= React ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³) ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ç½®ãå ´
- **`tsconfig.json`**: TypeScript è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
- **`tsconfig.node.json`**: é–‹ç™ºæ™‚ã«ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã®ã¿ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ãŸã‚ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
- **`webpack.config.ts`**: webpack è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

# TypeScript ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨è¨­å®š

TypeScript ã‚„å‘¨è¾ºãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚

## ğŸ“¥ TypeScript ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```shell:bash
npm install --save-dev typescript ts-node @types/node
```

`--save-dev` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨ã€ãã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ `package.json` ã® **`devDependencies`** ã‚¨ãƒ³ãƒˆãƒªã¸è¿½åŠ ã•ã‚Œã¾ã™ã€‚

- **`typescript`**: æœ¬ä½“
- **`ts-node`**: TypeScript ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ (`webpack.config.ts` ãªã©) ã‚’ãã®ã¾ã¾å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«
- **`@types/node`**: Node.js ã®ãŸã‚ã®å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«

## âš™ï¸ TypeScript è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼š `tsconfig.json` ã®ä½œæˆ

### 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ç›´ä¸‹ã« [`tsconfig.json`](https://www.typescriptlang.org/docs/handbook/tsconfig-json.html) ã‚’ä½œæˆã™ã‚‹

```json:tsconfig.json
{
  "compilerOptions": {
    "target": "ESNext",
    "module": "ESNext",
    "esModuleInterop": true,
    "moduleResolution": "node",
    "strict": true,
    "jsx": "react-jsx"
  },
  "include": ["src/**/*"],
  "ts-node": {
    "compilerOptions": {
      "module": "CommonJS"
    }
  }
}
```

- **[`target`](https://www.typescriptlang.org/ja/tsconfig#target)**: å‡ºåŠ›ã™ã‚‹ JavaScript ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨­å®šã—ã¾ã™ã€‚
- **[`module`](https://www.typescriptlang.org/ja/tsconfig#module)**: å‡ºåŠ›ã•ã‚Œã‚‹ JavaScript ãŒã©ã®å½¢å¼ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã‹ã‚’æŒ‡å®šã—ã¾ã™ã€‚ ä¸‹ã® `esModuleInterop` ã‚’ `true` ã«è¨­å®šã—ã¦ãŠãã€`ES*` ã‚’æŒ‡å®šã—ã¦ãŠãã®ãŒç„¡é›£ã§ã—ã‚‡ã†ã€‚
- **[`esModuleInterop`](https://www.typescriptlang.org/ja/tsconfig#esModuleInterop)**: CommonJS ã¨ ES Modules é–“ã§ç›¸äº’é‹ç”¨å¯èƒ½ãªã‚³ãƒ¼ãƒ‰ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚
- **[`moduleResolution`](https://www.typescriptlang.org/ja/tsconfig#moduleResolution)**: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è§£æ±ºã®æ–¹æ³•ã‚’æŒ‡å®šã—ã¾ã™ã€‚ç¾çŠ¶ã§ã¯ `node` ã®æŒ‡å®šã§ã»ã¼å•é¡Œãªã„ã§ã—ã‚‡ã†ã€‚
- **[`lib`](https://www.typescriptlang.org/ja/tsconfig#lib)**: å¿…é ˆã§ã¯ãªã„ã®ã§è¨­å®šã—ã¾ã›ã‚“ã€‚`target` ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚Œã°ã€ãã® `target` ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯è‡ªå‹•çš„ã«è¿½åŠ ã•ã‚Œã‚‹ã‹ã‚‰ã§ã™ã€‚é€†ã« `lib` ã‚’æŒ‡å®šã™ã‚‹ã¨ã€æ˜ç¤ºçš„ã« `target` ã®ã©ã® `lib` ã‚’ä½¿ã†ã‹ã‚‚æ˜è¨˜ã—ãªã‘ã‚Œã°ã„ã‘ãªããªã‚Šã¾ã™ã€‚
- **[`strict`](https://www.typescriptlang.org/ja/tsconfig#strict)**: TypeScript ã«ã‚ˆã‚‹å¹…åºƒã„å‹ãƒã‚§ãƒƒã‚¯ã®æŒ™å‹•ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚ã“ã‚Œã ã¨å³ã—ã™ãã‚‹å ´åˆã«ã¯ã€å€‹åˆ¥ã® `strict` ãƒ¢ãƒ¼ãƒ‰ãƒ•ã‚¡ãƒŸãƒªãƒ¼ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
- **[`jsx`](https://www.typescriptlang.org/ja/tsconfig#jsx)**: JSX æ§‹æ–‡ãŒã©ã®ã‚ˆã†ã« JavaScript ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ã•ã‚Œã‚‹ã‹ã‚’è¨­å®šã—ã¾ã™ã€‚ `.tsx` ã§çµ‚ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã® JS å‡ºåŠ›ã«ã®ã¿å½±éŸ¿ã—ã¾ã™ã€‚
  - **`preserve`**: JSX ã‚’å¤‰æ›´ã›ãšã« `.jsx` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚
  - **`react`**: JSX ã‚’ç­‰ä¾¡ãª `react.createElement` ã«å¤‰æ›ã—ã¦ `.js` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚
  - **`react-jsx`**: JSX ã‚’ `_jsx` å‘¼ã³å‡ºã—ã«å¤‰æ›´ã—ãŸ `.js` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚å¤šãã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ React æœ¬ä½“ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹å¿…è¦ãŒãªããªã‚Šã¾ã™ã€‚
- **[`include`](https://www.typescriptlang.org/ja/tsconfig#include)**: ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«å«ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«åã¾ãŸã¯ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒªã‚¹ãƒˆã‚’æŒ‡å®šã—ã¾ã™ã€‚ ãƒ•ã‚¡ã‚¤ãƒ«åã¯ `tsconfig.json` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã‚“ã§ã„ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ã®ç›¸å¯¾ãƒ‘ã‚¹ã¨ã—ã¦è§£æ±ºã•ã‚Œã¾ã™ã€‚
- **`ts-node`**: [ts-node](https://typestrong.org/ts-node/) ã§ Node.js ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ï¼ˆ`webpack.config.ts` ãªã©ã® TypeScript ã§æ›¸ã‹ã‚ŒãŸè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è©•ä¾¡ã™ã‚‹ï¼‰ã«ã¯ `module: CommonJS` ã®æŒ‡å®šãŒå¿…è¦ã§ã™ã€‚

### 2. åŒã˜ããƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ç›´ä¸‹ã« `tsconfig.node.json` ã‚’ä½œæˆã™ã‚‹

ã“ã® TypeScript è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€é–‹ç™ºæ™‚ã«ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆã¨ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼‰ã®ã¿ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ãŸã‚ã«åˆ©ç”¨ã—ã¾ã™ã€‚

```json:tsconfig.node.json
{
  "extends": ".",
  "compilerOptions": {
    "module": "CommonJS",
    "outDir": "dist"
  },
  "include": ["src/*.ts", "src/@types/*"]
}
```

- **[`extends`](https://www.typescriptlang.org/ja/tsconfig#extends)**: ä¸Šè¨˜ `tsconfig.json` ã®è¨­å®šã‚’ç¶™æ‰¿ã—ã¾ã™ã€‚é€†ã«è¨€ã†ã¨ãã®ä»–ã®æ˜ç¤ºçš„ã«æŒ‡å®šã—ãŸã‚¨ãƒ³ãƒˆãƒªã®è¨­å®šã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚

# Electron ã‚¢ãƒ—ãƒªã®ä½œæˆ

å¿…è¦æœ€ä½é™ã®æ©Ÿèƒ½ã‚’æŒã£ãŸ Electron ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã™ã€‚

## ğŸ“¥ Electron ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

Electron ã¯ `package.json` ã® **`devDependencies`** ã¸ã‚¨ãƒ³ãƒˆãƒªã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- æœ¬ä½“

```shell:bash
npm install --save-dev electron
```

- Electron ã‚’ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ãƒ«

```shell:bash
npm install --save-dev electron-reload
```

https://www.npmjs.com/package/electron-reload

## âš’ï¸ ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã®ä½œæˆ

```ts:src/main.ts
import path from 'node:path';
import { BrowserWindow, app } from 'electron';

// é–‹ç™ºæ™‚ã«ã¯ electron ã‚¢ãƒ—ãƒªã‚’ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹
if (process.env.NODE_ENV === "development") {
  require("electron-reload")(__dirname, {
    electron: path.resolve(
      __dirname,
      process.platform === "win32"
        ? "../node_modules/electron/dist/electron.exe"
        : "../node_modules/.bin/electron",
    ),
    forceHardReset: true,
    hardResetMethod: "exit",
  });
}

app.whenReady().then(() => {
  // ã‚¢ãƒ—ãƒªã®èµ·å‹•ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã§ BrowserWindow ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
  const mainWindow = new BrowserWindow({
    webPreferences: {
      // tsc or webpack ãŒå‡ºåŠ›ã—ãŸãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èª­ã¿è¾¼ã¿
      preload: path.join(__dirname, 'preload.js'),
    },
  });

  // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã‚’ãƒ­ãƒ¼ãƒ‰
  mainWindow.loadFile('dist/index.html');
});

// ã™ã¹ã¦ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒé–‰ã˜ã‚‰ã‚ŒãŸã‚‰ã‚¢ãƒ—ãƒªã‚’çµ‚äº†ã™ã‚‹
app.once('window-all-closed', () => app.quit());
```

## âš’ï¸ ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ

ã“ã“ã§ã¯ã¨ã‚Šã‚ãˆãšç©ºã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¾ã™ã€‚

```ts:src/preload.ts
console.log('preloaded!');
```

# React ã‚¢ãƒ—ãƒªï¼ˆãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ï¼‰ã®ä½œæˆ

ã“ã¡ã‚‰ã‚‚æœ€ä½é™ã®ä½“è£ã‚’å‚™ãˆãŸã‚¢ãƒ—ãƒªï¼ˆ= WebView éƒ¨åˆ†ï¼‰ã‚’ä½œæˆã—ã¾ã™ã€‚

## ğŸ“¥ React ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

- æœ¬ä½“

```shell:bash
npm install react react-dom
```

`--save-dev` ã‚ªãƒ—ã‚·ãƒ§ãƒ³**ãªã—**ï¼ˆã‚‚ã—ãã¯ `--save` or `-S` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä»˜ãï¼‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨ã€ãã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ `package.json` ã® **`dependencies`** ã‚¨ãƒ³ãƒˆãƒªã¸è¿½åŠ ã•ã‚Œã¾ã™ã€‚

- å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«

```shell:bash
npm install -D @types/react @types/react-dom
```

**`-D`** ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ `--save-dev` ã®çœç•¥å½¢ã§ã™ã€‚

## âš’ï¸ ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã®ä½œæˆ

ç”»é¢ã« `Hello.` ã¨è¡¨ç¤ºã™ã‚‹ã ã‘ã®ã‚·ãƒ³ãƒ—ãƒ«ãª React ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã™ã€‚

### ğŸ“‹ src/web/index.html

```html:src/web/index.html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- CSP ã®è¨­å®š https://developer.mozilla.org/ja/docs/Web/HTTP/CSP -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self';" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Electron App</title>
  </head>
  <body>
    <!-- React ã‚¢ãƒ—ãƒªã®ãƒã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆ -->
    <div id="root"></div>
  </body>
</html>
```

https://www.electronjs.org/ja/docs/latest/tutorial/security

https://developer.mozilla.org/ja/docs/Web/HTTP/CSP

### ğŸ“‹ src/web/App.css

```css:src/web/App.css
.container {
  font-family: sans-serif;
  text-align: center;
}
```

### ğŸ“‹ src/web/App.tsx

```jsx:src/web/App.tsx
import './App.css';

export const App = () => {
  return (
    <div className="container">
      <h1>Hello.</h1>
    </div>
  );
};
```

### ğŸ“‹ src/web/index.tsx

```jsx:src/web/index.tsx
import { StrictMode } from 'react';
import { createRoot } from 'react-dom/client';

import { App } from './App';

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>
);
```

# ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ (webpack) ã®è¨­å®š

[webpack](https://webpack.js.org/) ã‚’ä½¿ã£ã¦ã€é–‹ç™ºæ™‚ã«ã¯ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã®ã¿ã‚’ã€æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã§ã¯ãƒ¡ã‚¤ãƒ³ã€ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã¨ã‚‚ã«ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚

## ğŸ“¥ Webpack ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

https://webpack.js.org/

### æœ¬ä½“

```shell:bash
npm i -D webpack webpack-cli
```

### ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹ãŸã‚ã®å„ç¨®ãƒ­ãƒ¼ãƒ€ãƒ¼

- TypeScript ã¨ CSS ã®ãƒ­ãƒ¼ãƒ€ãƒ¼

```shell:bash
npm i -D ts-loader css-loader
```

https://www.npmjs.com/package/ts-loader
https://www.npmjs.com/package/css-loader

### å„ç¨®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³

```shell:bash
npm i -D html-webpack-plugin mini-css-extract-plugin
```

- **html-webpack-plugin**: ãƒãƒ³ãƒ‰ãƒ«ã•ã‚ŒãŸ JavaScirpt ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ HTML ã® `<script> ~ </script>` ã‚¿ã‚°ã¸å·®ã—è¾¼ã‚€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³
- **mini-css-extract-plugin**: CSS ã‚’ JS ã¸ãƒãƒ³ãƒ‰ãƒ«ã›ãšå˜ç‹¬ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³

https://www.npmjs.com/package/html-webpack-plugin
https://www.npmjs.com/package/mini-css-extract-plugin

## âš™ï¸ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« webpack.config.ts ã®ä½œæˆ

é–‹ç™ºæ™‚ã«ã¯ watch ãƒ¢ãƒ¼ãƒ‰ã‚’ç”¨ã„ã¦ã€ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰æ›´ã•ã‚Œã‚‹ãŸã³ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼†ãƒãƒ³ãƒ‰ãƒ«ã—ã¾ã™ã€‚

ãã®çµæœãŒ `dist` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸å‡ºåŠ›ã•ã‚Œã‚‹ã¨ã€`electron-reload` ãŒãã®å¤‰æ›´ã‚’æ¤œçŸ¥ã—ã¦ã€ Electron ã‚¢ãƒ—ãƒªã‚’ãƒªã‚¹ã‚¿ãƒ¼ãƒˆã•ã›ã¾ã™ã€‚

```typescript:webpack.config.ts
/** ã‚¨ãƒ‡ã‚£ã‚¿ã§è£œå®Œã‚’åŠ¹ã‹ã›ã‚‹ãŸã‚ã«å‹å®šç¾©ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ */
import { Configuration } from 'webpack';

import HtmlWebpackPlugin from 'html-webpack-plugin';
import MiniCssExtractPlugin from 'mini-css-extract-plugin';

// é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ã‹å¦ã‹ã§å‡¦ç†ã‚’åˆ†å²ã™ã‚‹
const isDev = process.env.NODE_ENV === 'development';

// å…±é€šè¨­å®š
const common: Configuration = {
  // ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
  mode: isDev ? 'development' : 'production',
  // ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è§£æ±ºã«å‚ç…§ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­
  resolve: {
    extensions: ['.js', '.ts', '.jsx', '.tsx', '.json'],
  },
  /**
   * macOS ã§ãƒ“ãƒ«ãƒ‰ã«å¤±æ•—ã™ã‚‹å ´åˆã®ãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ©ã‚¦ãƒ³ãƒ‰
   * https://github.com/yan-foto/electron-reload/issues/71
   */
  externals: ['fsevents'],
  // å‡ºåŠ›å…ˆï¼šãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ 'dist'
  output: {
    // ç”»åƒãªã©ã®ã‚¢ã‚»ãƒƒãƒˆé¡ã¯ 'dist/assets' ãƒ•ã‚©ãƒ«ãƒ€ã¸é…ç½®ã™ã‚‹
    assetModuleFilename: 'assets/[name][ext]',
  },
  module: {
    // ãƒ•ã‚¡ã‚¤ãƒ«ç¨®åˆ¥ã”ã¨ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ« & ãƒãƒ³ãƒ‰ãƒ«ã®ãƒ«ãƒ¼ãƒ«
    rules: [
      {
        /**
         * æ‹¡å¼µå­ '.ts' ã¾ãŸã¯ '.tsx' ï¼ˆæ­£è¦è¡¨ç¾ï¼‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ 'ts-loader' ã§å‡¦ç†
         * ãŸã ã— node_modules ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯é™¤å¤–ã™ã‚‹
         */
        test: /\.tsx?$/,
        exclude: /node_modules/,
        loader: 'ts-loader',
      },
      {
        // æ‹¡å¼µå­ '.css' ï¼ˆæ­£è¦è¡¨ç¾ï¼‰ã®ãƒ•ã‚¡ã‚¤ãƒ«
        test: /\.css$/,
        // use é…åˆ—ã«æŒ‡å®šã—ãŸãƒ­ãƒ¼ãƒ€ãƒ¼ã¯ *æœ€å¾Œå°¾ã‹ã‚‰* é †ã«é©ç”¨ã•ã‚Œã‚‹
        // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã®ãŸã‚ style-loader ã¯ä½¿ç”¨ã—ãªã„
        use: [MiniCssExtractPlugin.loader, 'css-loader'],
      },
      {
        // ç”»åƒã‚„ãƒ•ã‚©ãƒ³ãƒˆãªã©ã®ã‚¢ã‚»ãƒƒãƒˆé¡
        test: /\.(ico|png|svg|eot|woff?2?)$/,
        /**
         * ã‚¢ã‚»ãƒƒãƒˆé¡ã‚‚åŒæ§˜ã« asset/inline ã¯ä½¿ç”¨ã—ãªã„
         * ãªãŠã€webpack@5.x ã§ã¯ file-loader or url-loader ã¯ä¸è¦ã«ãªã£ãŸ
         */
        type: 'asset/resource',
      },
    ],
  },
  // é–‹ç™ºæ™‚ã«ã¯ watch ãƒ¢ãƒ¼ãƒ‰ã§ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰åŒ–ã‚’ç›£è¦–ã™ã‚‹
  watch: isDev,
  /**
   * development ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—ã‚’ä»˜ã‘ã‚‹
   *
   * ãªãŠã€é–‹ç™ºæ™‚ã®ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã§ã¯ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—ãŒãªã„ã¨
   * electron ã®ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã« 'Uncaught EvalError' ãŒ
   * è¡¨ç¤ºã•ã‚Œã¦ã—ã¾ã†ã“ã¨ã«æ³¨æ„
   */
  devtool: isDev ? 'source-map' : undefined,
};

// ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹å‘ã‘è¨­å®š
const main: Configuration = {
  // å…±é€šè¨­å®šã‚’èª­ã¿è¾¼ã¿
  ...common,
  target: 'electron-main',
  // ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒãƒ£ãƒ³ã‚¯åã® 'main.js' ã¨ã—ã¦å‡ºåŠ›ã•ã‚Œã‚‹ï¼‰
  entry: {
    main: './src/main.ts',
  },
};

// ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆå‘ã‘è¨­å®š
const preload: Configuration = {
  ...common,
  target: 'electron-preload',
  entry: {
    preload: './src/preload.ts',
  },
};

// ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹å‘ã‘è¨­å®š
const renderer: Configuration = {
  ...common,
  // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã¨ã—ã¦ 'electron-renderer' ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¯ä½¿ç”¨ã—ãªã„
  target: 'web',
  entry: {
    // React ã‚¢ãƒ—ãƒªã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«
    app: './src/web/index.tsx',
  },
  plugins: [
    // CSS ã‚’ JS ã¸ãƒãƒ³ãƒ‰ãƒ«ã›ãšåˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³
    new MiniCssExtractPlugin(),
    /**
     * ãƒãƒ³ãƒ‰ãƒ«ã—ãŸJSãƒ•ã‚¡ã‚¤ãƒ«ã‚’ <script></scrip> ã‚¿ã‚°ã¨ã—ã¦å·®ã—è¾¼ã‚“ã 
     * HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³
     */
    new HtmlWebpackPlugin({
      // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
      template: './src/web/index.html',
    }),
  ],
};

// ä¸Šè¨˜ 3 ã¤ã®è¨­å®šã‚’é…åˆ—ã«ã—ã¦ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
// ãŸã ã—é–‹ç™ºæ™‚ã«ã¯ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã®ã¿ã‚’ãƒãƒ³ãƒ‰ãƒ«ã—ã€ãƒ¡ã‚¤ãƒ³ or ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã¯ tsc ã«å‡¦ç†ã•ã›ã‚‹
export default isDev ? renderer : [main, preload, renderer];
```

# NPM ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®è¨­å®š

é–‹ç™ºæ™‚ã‚„æœ¬ç•ªãƒ“ãƒ«ãƒ‰æ™‚ã«èµ°ã‚‰ã›ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ `package.json` ã¸è¿½è¨˜ã—ã¾ã™ã€‚

## ğŸ“¥ å„ç¨®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```shell:bash
npm i -D rimraf wait-on cross-env npm-run-all
```

- [rimraf](https://www.npmjs.com/package/rimraf)
  ã©ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã‚‚ UNIX ã® `rm -rf` ã¨åŒç­‰ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿç¾ã™ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã€‚
- [wait-on](https://www.npmjs.com/package/wait-on)
  æŒ‡å®šã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®Œäº†ã™ã‚‹ã®ã‚’å¾…ã£ã¦åˆ¥ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã‚Œã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã€‚
- [cross-env](https://www.npmjs.com/package/cross-env)
  ã©ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã‚‚ç’°å¢ƒå¤‰æ•°ã®è¨­å®šãŒå…±é€šã¨ãªã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã€‚
- [npm-run-all](https://www.npmjs.com/package/npm-run-all)
  - **`run-s`:** ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’é †ç•ªã«å®Ÿè¡Œã€‚
  - **`run-p`:** ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä¸¦åˆ—ã«å®Ÿè¡Œã€‚

## âš™ï¸ NPM ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ

```json:package.json
{
  "main": "dist/main.js",
  "scripts": {
    "dev": "rimraf dist && run-p dev:*",
    "build": "rimraf dist && cross-env NODE_ENV=\"production\" webpack --progress",
    "dev:tsc": "tsc -w -p tsconfig.node.json",
    "dev:webpack": "cross-env NODE_ENV=\"development\" webpack --progress",
    "dev:electron": "wait-on ./dist/index.html ./dist/main.js && cross-env NODE_ENV=\"development\" electron ."
  }
}
```

- **main** ã‚¨ãƒ³ãƒˆãƒªã«ã¯ webpack ãŒå‡ºåŠ›ã™ã‚‹ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã® JS ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¾ã™ã€‚
- **scripts**
  - **dev:tsc:** ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã¨ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã® tsc ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¾ã™ã€‚
  - **dev:webpack:** ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã‚’ webpack ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼†ãƒãƒ³ãƒ‰ãƒ«ã—ã¾ã™ã€‚
  - **dev:electron:** tsc ã¨ webpack ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«çµæœãŒå‡ºåŠ›ã•ã‚Œã‚‹ã®ã‚’å¾…ã£ã¦ electronã‚’èµ·å‹•ã—ã¾ã™ã€‚
  - **dev:** `npm run dev` ã§ã€å‰å›ã®ãƒ“ãƒ«ãƒ‰çµæœã‚’å‰Šé™¤ã—ãŸã‚ã¨ä¸Šè¨˜ 3 ã¤ã®ã‚³ãƒãƒ³ãƒ‰ã‚’**ä¸¦åˆ—ã«**å®Ÿè¡Œã—ã¾ã™ã€‚
  - **build** æœ¬ç•ªå‘ã‘ãƒ“ãƒ«ãƒ‰ã‚’ `production` ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œã—ã¾ã™ã€‚

# å®Ÿè¡Œãƒ†ã‚¹ãƒˆ

React ã‚¢ãƒ—ãƒªï¼ˆãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ï¼‰ã‚„ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã®ã‚³ãƒ¼ãƒ‰ã‚’ç·¨é›†ã—ã€ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

```bashell:bash
npm run dev
```

![main](https://user-images.githubusercontent.com/52094761/235551746-490c7b46-8d34-45a8-bd96-9afb0d37cb61.gif)
_é–‹ç™ºæ™‚ã®ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆElectron ã®å†èµ·å‹•ï¼‰_

:::message
é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹ã‚’çµ‚äº†ã™ã‚‹ã«ã¯ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ **`Ctrl-C`** ã‚’æ‰“éµã—ã¦ãã ã•ã„ã€‚
:::

# ã“ã¡ã‚‰ã‚‚ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™

https://zenn.dev/sprout2000/books/6f6a0bf2fd301c

https://zenn.dev/sprout2000/books/3691a679478de2
