---
title: "ã„ã¡ã°ã‚“ã‚„ã•ã—ã„ webpack å…¥é–€"
emoji: "ğŸ¦”"
type: "tech"
topics:
  - "javascript"
  - "react"
  - "typescript"
  - "webpack"
  - "å…¥é–€"
published: true
published_at: "2022-05-02 17:43"
---

# webpack is ä½•?

[webpack](https://webpack.js.org/) ã¨ã¯ã€ä¸€è¨€ã§è¨€ã†ã¨ JavaScript å‘ã‘ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§ã™ã€‚
è¤‡æ•°ã® JavaScript ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä¸€ã¤ï¼ˆã¾ãŸã¯ã„ãã¤ã‹ï¼‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¸ãƒãƒ³ãƒ‰ãƒ«ï¼ˆ=`bundle: æŸã«ã™ã‚‹ã€åŒ…ã‚€`ï¼‰ã—ã¦ãã‚Œã¾ã™ã€‚

https://webpack.js.org/

![](https://storage.googleapis.com/zenn-user-upload/b4a7009c84a7-20220501.png)
_è¤‡æ•°ã® JS ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ï¼ˆå ´åˆã«ã‚ˆã£ã¦ã¯ CSS ã‚„ç”»åƒãªã©ã®ã‚¢ã‚»ãƒƒãƒˆé¡ã‚‚ï¼‰ä¸€ã¤ã«ã¾ã¨ã‚ã‚‹_

# ä½¿ã†ãƒ¡ãƒªãƒƒãƒˆã¯ä½•ï¼Ÿ

- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ 1 ã¤ï¼ˆã‚‚ã—ãã¯å°‘æ•°ï¼‰ã«ã¾ã¨ã‚ã‚‹ã“ã¨ã§ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã‚’æ¸›ã‚‰ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«è»¢é€ã®åŠ¹ç‡ãŒå‘ä¸Šã—ã¾ã™ã€‚
- [ES Modules](https://developer.mozilla.org/ja/docs/Web/JavaScript/Guide/Modules) ã‚„ CommonJS å½¢å¼ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãªã©ã€ã•ã¾ã–ã¾ãªå½¢å¼ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚
- ä¸Šè¨˜ã® JS ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã¿ãªã‚‰ãšã€CSS ã‚„ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

https://developer.mozilla.org/ja/docs/Web/JavaScript/Guide/Modules

# ã¨ã‚Šã‚ãˆãš webpack ã‚’ä½¿ã£ã¦ã¿ã‚‹

:::message
å‰æã¨ã—ã¦ [Node.js](https://nodejs.org/ja/) ã¨ [Visual Studio Code](https://code.visualstudio.com/) ãŒã™ã§ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚
:::

https://nodejs.org/

https://code.visualstudio.com/

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ»ãƒ•ã‚©ãƒ«ãƒ€ã®ä½œæˆ

**"zenn-webpack"** ã¨ã„ã†åå‰ã®ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã€[Node.js](https://nodejs.org/ja/) ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦åˆæœŸåŒ–ã—ã¾ã™ã€‚

```sh:bash
mkdir zenn-webpack
cd zenn-webpack

# Node.js ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦åˆæœŸåŒ–
npm init --yes
```

:::message
[`npm` ã‚³ãƒãƒ³ãƒ‰](https://docs.npmjs.com/cli/v8/commands/npm)ã¯ Node.js ã«åŒæ¢±ã•ã‚Œã¦ã„ã¾ã™ã€‚
:::

https://docs.npmjs.com/cli/v8/commands/npm

## 2. webpack ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã« webpack ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

- æœ¬ä½“

```sh:bash
npm install --save-dev webpack
```

- webpack ã‚’ CLI ã‹ã‚‰åˆ©ç”¨ã™ã‚‹ãŸã‚ã«å¿…è¦ãªãƒ„ãƒ¼ãƒ«

```sh:bash
npm install --save-dev webpack-cli
```

## 3. ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®ç”¨æ„

ãƒãƒ³ãƒ‰ãƒ«å‰ã® `hello.js` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã€ãã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹ `index.js` ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ `src` ãƒ•ã‚©ãƒ«ãƒ€å†…ã¸ä½œæˆã—ã¾ã™ã€‚

```js:src/hello.js
export class Hello {
  constructor(name) {
    this.name = name;
  }

  greet() {
    console.log(`Hello, ${this.name}!`);
  }
}
```

```js:src/index.js
import { Hello } from "./hello";

new Hello("taro").greet();
```

ã“ã“ã¾ã§ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã®æ§‹æˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```sh
% tree -I 'node_modules'
.
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â””â”€â”€ src
    â”œâ”€â”€ hello.js
    â””â”€â”€ index.js

1 directory, 4 files
```

## 4. ãƒãƒ³ãƒ‰ãƒ«ã®å®Ÿè¡Œ

webpack ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€`src/index.js`ï¼ˆï¼**ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«**ï¼‰ã¨ãã“ã‹ã‚‰èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒãƒ³ãƒ‰ãƒ«ã—ã¦ `dist/main.js` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚

webpack ã‚’èµ·å‹•ã—ã¦ãƒãƒ³ãƒ‰ãƒ«ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

- ãƒãƒ³ãƒ‰ãƒ«ã®å®Ÿè¡Œ

```sh:bash
./node_modules/.bin/webpack
```

- ã¾ãŸã¯ npx ã‚³ãƒãƒ³ãƒ‰ï¼ˆnpm ã«åŒæ¢±ï¼‰ã‚’åˆ©ç”¨ã™ã‚‹

```sh:bash
npx webpack
```

```sh
asset main.js 127 bytes [emitted] [minimized] (name: main)
orphan modules 138 bytes [orphan] 1 module
./src/index.js + 1 modules 218 bytes [built] [code generated]

WARNING in configuration
The 'mode' option has not been set, webpack will fallback to 'production' for this value.
Set 'mode' option to 'development' or 'production' to enable defaults for each environment.
You can also set it to 'none' to disable any default behavior. Learn more: https://webpack.js.org/configuration/mode/

webpack 5.72.0 compiled with 1 warning in 102 ms
```

`dist` ãƒ•ã‚©ãƒ«ãƒ€ãŒä½œæˆã•ã‚Œã€`main.js` ã¨ã„ã†ãƒãƒ³ãƒ‰ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‡ºåŠ›ã•ã‚Œã¾ã—ãŸã€‚

```diff sh
  .
+ â”œâ”€â”€ dist
+ â”‚   â””â”€â”€ main.js
  â”œâ”€â”€ package-lock.json
  â”œâ”€â”€ package.json
  â””â”€â”€ src
      â”œâ”€â”€ hello.js
      â””â”€â”€ index.js
```

## 5. ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒã¨ Watch ãƒ¢ãƒ¼ãƒ‰ã®åˆ©ç”¨

ã§ã¯ã€ä¸Šã§å‡ºåŠ›ã•ã‚ŒãŸ `dist/main.js` ã‚’èª­ã¿è¾¼ã‚€ HTML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ãã‚Œã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒã§ã‚µãƒ¼ãƒ–ã—ã¦ã¿ã¾ã™ã€‚

```html:dist/index.html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Webpack</title>
  </head>
  <body>
    <script src="./main.js"></script>
  </body>
</html>
```

```sh
.
â”œâ”€â”€ dist
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ main.js
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â””â”€â”€ src
    â”œâ”€â”€ hello.js
    â””â”€â”€ index.js
```

ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒã«ã¯ã€[VS Code](https://code.visualstudio.com/) ã® [Live Server](https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer) æ‹¡å¼µæ©Ÿèƒ½ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer

ã“ã®æ‹¡å¼µæ©Ÿèƒ½ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‰ã€VS Code ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€å†…ã® `dist/index.html` ã‚’é–‹ã„ãŸçŠ¶æ…‹ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã® ğŸ“¡ **"Go Live"** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/f98fab307861-20220501.png)

ãƒ–ãƒ©ã‚¦ã‚¶ã§ [localhost:5500](http://localhost:5500) ãŒé–‹ã‹ã‚Œã‚‹ã®ã§ã€ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆâ€»ï¼‰ã‚’ç¢ºèªã™ã‚‹ã¨ `Hello, taro!` ã¨å‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/e0e05f7b25c8-20220501.png)

:::message
ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’é–‹ãã«ã¯ã€Windows ã§ã¯ `Ctrl+Shit+I`ã€macOS ã§ã¯ `Cmd+Option+I` ã‚’æ‰“éµã—ã€ä¸Šã®ç”»åƒã®é€šã‚Šã€**"Console"** ã‚¿ãƒ–ã‚’é¸æŠã—ã¾ã™ã€‚
:::

webpack ã«ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ã‚’æ¤œçŸ¥ã—ã¦è‡ªå‹•çš„ã«å†ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹ watch ãƒ¢ãƒ¼ãƒ‰ã‚‚ç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚
`--watch` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜åŠ ã—ã¦ã‚‚ã†ä¸€åº¦ãƒãƒ³ãƒ‰ãƒ«ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```sh
npx webpack --watch
```

ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ã¦ã¿ã¾ã™ã€‚

```diff js:src/index.js
  import { Hello } from "./hello";

- new Hello("taro").greet();
+ new Hello("Jiro").greet();
```

![](https://storage.googleapis.com/zenn-user-upload/c693809dcc03-20220501.png)
_å‡ºåŠ›å†…å®¹ãŒ `Hello, Jiro!` ã«ä»£ã‚ã£ãŸ_

:::message
watch ãƒ¢ãƒ¼ãƒ‰ãªã©ã®å®Ÿè¡Œä¸­ã®ã‚³ãƒãƒ³ãƒ‰ã‚’åœæ­¢ã™ã‚‹ã«ã¯ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ **`Ctrl-C`** ã‚’æ‰“éµã—ã¦ãã ã•ã„ã€‚
:::

## 6. ãƒãƒ³ãƒ‰ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª

ä¸Šã§å‡ºåŠ›ã•ã‚ŒãŸ `dist/main.js` ã®å†…å®¹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼ˆè¦‹ã‚„ã™ã„ã‚ˆã†ã«æ•´å½¢æ¸ˆã¿ï¼‰ã€‚

```js:dist/main.js
(() => {
  'use strict';
  new (class {
    constructor(e) {
      this.name = e;
    }
    greet() {
      console.log(`Hello, ${this.name}`);
    }
  })('Jiro').greet();
})();
```

ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ãŒãã†ãªã£ã¦ã„ã‚‹ã®ã ã‹ã‚‰å½“ãŸã‚Šå‰ã§ã™ãŒã€ã“ã®ãƒãƒ³ãƒ‰ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ [`class`](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Classes) ãªã©ã® ES2015 ä»¥é™ã®è¨˜æ³•ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Classes

https://thinkit.co.jp/article/10434/

ã¤ã¾ã‚Šã€ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ **Internet Explorer ã‚„ãã®ä»–ã®å¤ã„ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯å®Ÿè¡Œã§ãã¾ã›ã‚“**ã€‚

![](https://storage.googleapis.com/zenn-user-upload/18dfe77731f4-20220501.png)

ã“ã®ã‚ˆã†ãªå¤ã„ç’°å¢ƒã§å‹•ä½œã•ã›ã‚‹ã«ã¯ã€**ãƒãƒªãƒ•ã‚£ãƒ«/ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©**ã«ã‚ˆã‚‹ **ES è¨˜æ³•**ã¸ã®å¤‰æ›ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚

# webpack ã¸ Babel ã‚’è¿½åŠ 

[Babel](https://babeljs.io/) ã¯ JavaScript ç”¨ã®ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©ï¼ˆãƒãƒªãƒ•ã‚£ãƒ«ï¼‰ã§ã™ã€‚
ES6 (ES2015+) ã‚’ ES5 ã¸å¤‰æ›ã™ã‚‹ã ã‘ã§ã¯ãªãã€**[JSX](https://ja.legacy.reactjs.org/docs/introducing-jsx.html) ãªã©ã®éæ¨™æº–ã® JavaScript æ§‹æ–‡ã‚’ ES\* ã¸å¤‰æ›**ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

https://babeljs.io/

https://ja.react.dev/learn/describing-the-ui

## Babel ã®å°å…¥

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ [Babel](https://babeljs.io/) ã‚’è¿½åŠ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã€webpack ã§ã®ãƒãƒ³ãƒ‰ãƒ«æ™‚ã«ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã‚‚ä½µã›ã¦è¡Œãˆã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

- Babel æœ¬ä½“

```sh:bash
npm install --save-dev @babel/core
```

- ES6 -> ES5 ã®å¤‰æ›ã«å¿…è¦ãªãƒ—ãƒªã‚»ãƒƒãƒˆ

```sh:bash
npm install --save-dev @babel/preset-env
```

## ãƒ­ãƒ¼ãƒ€ãƒ¼ã®å°å…¥

webpack ã§ã¯ã€JS ã®å½¢å¼ã‚’å¤‰æ›ã—ãŸã‚Šã€CSSï¼ˆã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆï¼‰ã‚„ã‚¢ã‚»ãƒƒãƒˆç”»åƒãªã©ã‚’ JS ã¸ãƒãƒ³ãƒ‰ãƒ«ã—ãŸã‚Šã™ã‚‹ã¨ãã«ã¯**ãƒ­ãƒ¼ãƒ€ãƒ¼**ã¨å‘¼ã°ã‚Œã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

å¤‰æ›ã®å½¢å¼ï¼ˆ`jsx -> js`, `ts -> js` ãªã©ï¼‰ã‚„ãƒãƒ³ãƒ‰ãƒ«ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã«å¿œã˜ã¦é©åˆ‡ãªãƒ­ãƒ¼ãƒ€ãƒ¼ã‚’ webpack ã«åˆ©ç”¨ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã“ã§ã¯ Babel ã«ã€ŒES6 ã‹ã‚‰ ES5 ã¸ã€ã®å¤‰æ›ã‚’ã•ã›ã‚‹ã®ã§ [babel-loader](https://github.com/babel/babel-loader) ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

https://github.com/babel/babel-loader#readme

```sh:bash
npm install --save-dev babel-loader
```

## è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« `.babelrc` ã®ä½œæˆ

Babel ã®è¨­å®šã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ç›´ä¸‹ã® `.babelrc` ãƒ•ã‚¡ã‚¤ãƒ«ã¸è¨˜è¿°ã—ã¾ã™ã€‚
ã“ã“ã§ã¯ä¸Šã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒ—ãƒªã‚»ãƒƒãƒˆã‚’æŒ‡å®šã™ã‚‹ã ã‘ã§ã™ã€‚

```json:.babelrc
{
  "presets": ["@babel/preset-env"]
}
```

# `webpack.config.js` ã‚’ä½œæˆã™ã‚‹

ã“ã“ã¾ã§ã¯ã¨ãã«ä½•ã‹ã‚’è¨­å®šã™ã‚‹ã“ã¨ã‚‚ãªã webpack ã‚’ç›´æ¥å®Ÿè¡Œã—ã¦ãã¾ã—ãŸãŒã€Babel ã‚’ä½µã›ã¦åˆ©ç”¨ã™ã‚‹ãŸã‚ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒå‡ºã¦ãã¾ã—ãŸã€‚

webpack ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ JavaScript ã§è¨˜è¿°ã™ã‚‹å ´åˆã«ã¯ [CommonJS](https://ja.wikipedia.org/wiki/CommonJS) å½¢å¼ã‚’ç”¨ã„ã¾ã™ï¼ˆãã®ç†ç”±ã¯æœ¬ç¨¿ã§ã¯çœç•¥ã—ã¾ã™ï¼‰ã€‚

https://ja.wikipedia.org/wiki/CommonJS

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ç›´ä¸‹ã¸ `webpack.config.js` ã‚’ä½œæˆã—ã¾ã™ã€‚

```js:webpack.config.js
/** â†“ ã‚¨ãƒ‡ã‚£ã‚¿ã§è£œå®Œã‚’åŠ¹ã‹ã›ã‚‹ãŸã‚ã® JSDoc */
/** @type {import('webpack').Configuration} */
module.exports = {
  module: {
    rules: [
      {
        // æ‹¡å¼µå­ js ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæ­£è¦è¡¨ç¾ï¼‰
        test: /\.js$/,
        // ãƒ­ãƒ¼ãƒ€ãƒ¼ã®æŒ‡å®š
        loader: "babel-loader",
      },
    ],
  },
};
```

å¤‰æ›ã‚„ãƒãƒ³ãƒ‰ãƒ«ã®ãƒ«ãƒ¼ãƒ«ã¯ `module.rules` é…åˆ—ã«æŒ‡å®šã—ã¾ã™ã€‚
å¤šãã®å ´åˆã€`test` ã§ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚’æŒ‡å®šã—ã€`loader`ï¼ˆã¾ãŸã¯ `use` é…åˆ—ï¼‰ã¸ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ãµãŸãŸã³ webpack ã‚’èµ·å‹•ã—ã¦ãƒãƒ³ãƒ‰ãƒ«ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```sh:bash
npx webpack
```

å‡ºåŠ›ã•ã‚ŒãŸ `dist/main.js` ï¼ˆæ•´å½¢æ¸ˆã¿ï¼‰ã‚’ç¢ºèªã™ã‚‹ã¨ ES5 å½¢å¼ã¸å¤‰æ›ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

```js:dist/main.jsï¼ˆä¸€éƒ¨ã®ã¿ï¼‰
(() => {
  "use strict";
  function e(e, n) {
    for (var t = 0; t < n.length; t++) {
      var r = n[t];
      (r.enumerable = r.enumerable || !1),
        (r.configurable = !0),
        "value" in r && (r.writable = !0),
        Object.defineProperty(e, r.key, r);
    }
  }
```

# ãƒ¢ãƒ¼ãƒ‰ã¨ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—

## ãƒ¢ãƒ¼ãƒ‰ã®æŒ‡å®š

ã“ã“ã¾ã§ãƒãƒ³ãƒ‰ãƒ«ã—ã¦ããŸä¸­ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªè­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã—ãŸã€‚

```sh
WARNING in configuration
Set 'mode' option to 'development' or 'production'
to enable defaults for each environment.
```

`mode` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ `'development'`ï¼ˆé–‹ç™ºãƒ¢ãƒ¼ãƒ‰ï¼‰ã¾ãŸã¯ `'production'`ï¼ˆæœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ï¼‰ã®ç’°å¢ƒã«å¿œã˜ã¦è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚

`production` ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œã«å¿…è¦ã®ãªã„éƒ¨åˆ†ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚„æ”¹è¡Œãªã©ï¼‰ãŒã™ã¹ã¦å‰Šé™¤ã•ã‚Œã€å®Ÿè¡Œã«é©ã—ãŸå½¢å¼ã¸ã¨æœ€é©åŒ–ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã®ç¸®æ¸›ãªã©ï¼‰ãŒè¡Œã‚ã‚Œã¾ã™ã€‚

ä¸€æ–¹ã€`development` ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã“ã‚Œã‚‰ã®æœ€é©åŒ–ãŒè¡Œã‚ã‚Œãªã„ã®ã§ãƒ‡ãƒãƒƒã‚°ã«é©ã—ã¦ã„ã¾ã™ã€‚

ãƒ¢ãƒ¼ãƒ‰ã‚’ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰æŒ‡å®šã™ã‚‹å ´åˆã¯æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™ï¼š

```sh
npx webpack --mode development
```

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« `webpack.config.js` ã¸æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š

```diff js:webpack.config.js
  module.exports = {
+   mode: "development",
    module: {
      rules: [
```

## ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—

ã“ã“ã§ã¯ Babel ã«ã‚ˆã‚‹ ES6 ã‹ã‚‰ ES5 ã¸ã®å¤‰æ›ã‚’è¡Œãªã£ã¦ã„ã‚‹ãŸã‚ã€å¤‰æ›å‰å¾Œã®ã‚³ãƒ¼ãƒ‰å¯¾å¿œè¡¨ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚Œã°ãƒ‡ãƒãƒƒã‚°ã«å½¹ç«‹ã¡ã¾ã™ã€‚ãã‚ŒãŒ**ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—**ã§ã™ã€‚

webpack ã«ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—ã‚‚å‡ºåŠ›ã•ã›ã‚‹ã«ã¯ `devtool` ã‚¨ãƒ³ãƒˆãƒªã‚’æŒ‡å®šã—ã¾ã™ã€‚

```js:webpack.config.js
  mode: "development",
  devtool: "source-map",  // ã¾ãŸã¯ 'inline-source-map' ãªã©
```

ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—ãŒå­˜åœ¨ã™ã‚‹å ´åˆã«ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã® **Sources** ã‚¿ãƒ–ã‹ã‚‰å¤‰æ›å‰ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/b1ca7a9d3ab4-20220501.png)

# webpack-dev-server ã§ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã—ã‚ˆã†

ã“ã“ã¾ã§ã¯ VS Code ã®æ‹¡å¼µæ©Ÿèƒ½ LiveServer ã‚’åˆ©ç”¨ã—ã¦ãã¾ã—ãŸãŒã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒã‚‚ webpack ã‹ã‚‰ç«‹ã¡ä¸Šã’ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚[webpack-dev-server](https://webpack.js.org/configuration/dev-server/) ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```sh:bash
# npm install --save-dev ã¨åŒç¾©
npm i -D webpack-dev-server
```

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ devServer ã¯ãƒ›ã‚¹ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª **`/`** ã‚’èµ·ç‚¹ã¨ã—ã¦èµ·å‹•ã™ã‚‹ãŸã‚ã€ã‚µãƒ¼ãƒ–ã™ã¹ããƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ `webpack.config.js` å†…ã§æŒ‡å®šã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã“ã§ã¯ `index.html` ã‚’ç½®ã„ã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ã® **`./dist`** ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```js:webpack.config.js
  devtool: "source-map",
  devServer: {
    static: {
      directory: "./dist",
    },
  },
```

devServer ã®èµ·å‹•ã«ã¯ `serve` ã‚’ä»˜ã‘åŠ ãˆã¾ã™ã€‚

```sh:bash
npx webpack serve --mode development
```

[localhost:8080](http://localhost:8080) ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã¨ãƒãƒ³ãƒ‰ãƒ«çµæœãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚

ã¾ãŸã€`serve` ã‚³ãƒãƒ³ãƒ‰ã‚’ç”¨ã„ã¦èµ·å‹•ã—ãŸå ´åˆã«ã¯ `--watch` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨åŒæ§˜ã«è‡ªå‹•çš„ã«ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®å¤‰æ›´ãŒåæ˜ ï¼ˆ=ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ï¼‰ã•ã‚Œã¾ã™ã€‚

# JSX (React) ã‚‚ãƒãƒ³ãƒ‰ãƒ«ã—ã¦ã¿ã‚‹

## 1. Babel ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’è¿½åŠ 

ä¸Šã§ Babel ã¯ã€ŒJSX ãªã©ã®éæ¨™æº–ã® JavaScript æ§‹æ–‡ã‚’ ES\* ã¸å¤‰æ›ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€ã¨æ›¸ãã¾ã—ãŸãŒã€ãã®ãŸã‚ã«ã¯ `JSX -> JS` å¤‰æ›ç”¨ã®ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```sh:bash
npm i -D @babel/preset-react
```

```json:.babelrc
{
  "presets": ["@babel/preset-env", "@babel/preset-react"]
}
```

## 2. React ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

React ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```sh:bash
# npm install --save ã¨åŒç¾©
npm i -S react react-dom
```

## 3. React ã‚¢ãƒ—ãƒªã‚’æº–å‚™

`dist` ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ãƒãƒ³ãƒ‰ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã€`src` ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚·ãƒ³ãƒ—ãƒ«ãª React ã‚¢ãƒ—ãƒª (JSX) ã§ç½®ãæ›ãˆã¾ã™ã€‚

```sh:bash
rm dist/*.js* src/*.js
```

```jsx:src/App.jsx
import React from "react";

export const App = () => {
  return (
    <div className="container">
      <h1>Hello.</h1>
    </div>
  );
};
```

```jsx:src/index.jsx
import React from "react";
import { createRoot } from "react-dom/client";

import { App } from "./App";

createRoot(document.getElementById("root")).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
```

`dist` ãƒ•ã‚©ãƒ«ãƒ€å†…ã® `index.html` ã¸ React ã‚¢ãƒ—ãƒªã®ãƒã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚

```diff html:dist/index.html
    <body>
+     <div id="root"></div>
      <script src="./main.js"></script>
    </body>
```

```sh
% tree -I 'node_modules'
.
â”œâ”€â”€ dist
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ App.jsx
â”‚   â””â”€â”€ index.jsx
â””â”€â”€ webpack.config.js

2 directories, 6 files
```

## 4. ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã¨ä¾å­˜é–¢ä¿‚ã®è§£æ±º

æœ€åˆã®æ–¹ã§ã€Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ `src/index.js`ï¼ˆï¼ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã¨ãã“ã‹ã‚‰èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒãƒ³ãƒ‰ãƒ«ã—ã¦ã€ã¨æ›¸ãã¾ã—ãŸãŒã€ã“ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®çŠ¶æ…‹ã¯ã‚‚ã†ä½¿ãˆãªããªã‚Šã¾ã—ãŸã€‚

ã™ã§ã« `src/index.js` ã¯å­˜åœ¨ã›ãšã€ä»–ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹**ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `src/index.jsx` ã¨ãªã£ãŸ**ã‹ã‚‰ã§ã™ã€‚

å¾“å‰ã®ãƒãƒ³ãƒ‰ãƒ«ã®ãŸã‚ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨æ¬¡ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚

```sh:bash
$ npx webpack serve --mode development

ERROR in main
Module not found: Error: Can't resolve './src' in '/Foo/zenn-webpack'
```

ã€`src` ã§ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è§£æ±ºï¼ˆ=**resolve**ï¼‰ãŒå‡ºæ¥ã¾ã›ã‚“ã€ã¨ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€šã‚Šã€**ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã®ä¾å­˜é–¢ä¿‚ã®è§£æ±º**ã«ã©ã®ç¨®é¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã™ã¹ããªã®ã‹ã‚’æ˜ç¤ºçš„ã« webpack ã¸ä¼ãˆã‚‹å¿…è¦ãŒç”Ÿã˜ã¾ã—ãŸã€‚

ã“ã‚Œã«ã¯ **`resolve`** ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’ç”¨ã„ã¾ã™ã€‚ã“ã“ã¸ `.jsx` ã‚’åŠ ãˆã‚‹ã“ã¨ã§ webpack ã¯ `src/index.jsx` ã‚’ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦èªè­˜ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```js:webpack.config.js
module.exports = {
  // ä¾å­˜é–¢ä¿‚è§£æ±ºã«å‚ç…§ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ã‚’æŒ‡å®š
  resolve: {
    extensions: [".js", ".json", ".jsx"],
  },
```

ã¾ãŸã€å¤‰æ›ã®ãƒ«ãƒ¼ãƒ«ã‚‚å¤‰æ›´ã¨ãªã£ãŸãŸã‚ `module.rules` ã‚’æ›´æ–°ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚

```diff js:webpack.config.js
    module: {
      rules: [
        {
          // æ‹¡å¼µå­ js ã¾ãŸã¯ jsx ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæ­£è¦è¡¨ç¾ï¼‰
+         test: /\.jsx?$/,
-         test: /\.js$/,
          loader: "babel-loader",
        },
      ],
    },
```

å†åº¦ devServer ã‚’èµ·å‹•ã—ã¾ã™ã€‚

```sh:bash
npx webpack serve --mode development
```

![](https://storage.googleapis.com/zenn-user-upload/b5f25ef4354d-20220501.png)
_localhost:8080 ã§ React ã‚¢ãƒ—ãƒªãŒå‹•ä½œ_

# ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«åã‚„å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹

ä¸Šã® `resolve` è¨­å®šã«ã‚ˆã£ã¦ `src/index.jsx` ã‚’ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸãŒã€`index` ä»¥å¤–ã®ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆãŸã¨ãˆã° `main.jsx` ãªã©ï¼‰ã‚’ä½¿ã„ãŸã„å ´åˆã‚‚ã‚ã‚‹ã§ã—ã‚‡ã†ã€‚

ãã†ã„ã†å ´åˆã¯ **`entry`** ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã¸ãã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```diff js:webpack.config.js
  module.exports = {
    resolve: {
      extensions: [".js", ".json", ".jsx"],
    },
+   entry: "./src/main.jsx",
```

åŠ ãˆã¦ã€ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«åŒæ§˜ã«å‡ºåŠ›ã•ã‚Œã‚‹ãƒãƒ³ãƒ‰ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ã‚„å‡ºåŠ›å…ˆãƒ•ã‚©ãƒ«ãƒ€ã‚‚ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã¯ **`output`** ã‚¨ãƒ³ãƒˆãƒªã‚’ç”¨ã„ã¾ã™ã€‚

```js:webpack.config.js
// Node.js ã® path ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
const path = require("node:path");

module.exports = {
  entry: "./src/main.jsx",
  output: {
    // ãƒ•ã‚¡ã‚¤ãƒ«å
    filename: "bundle.js",
    // å‡ºåŠ›ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€
    path: path.resolve(__dirname, "dist"),
  },
```

ã“ã“ã§ã¯ `node:path` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦å‡ºåŠ›ãƒ•ã‚©ãƒ«ãƒ€ã®çµ¶å¯¾ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

https://nodejs.org/api/path.html

`entry` ã§ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒãƒ£ãƒ³ã‚¯åã‚’ä»˜ã‘ãŸå ´åˆã«ã¯å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚‚ãã®åå‰ã‚’é©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```js:webpack.config.js
  entry: {
    // ãƒãƒ£ãƒ³ã‚¯å "app"
    app: "./src/main.jsx",
  },
  output: {
    // [name] -> "app"
    filename: "[name].js",
    path: path.resolve(__dirname, "dist"),
  },
```

è¤‡æ•°ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆãªã©ã«è‡ªå‹•çš„ã«å‡ºåŠ›åã‚’å‰²ã‚ŠæŒ¯ã£ã¦ãã‚Œã‚‹ã®ã§ä¾¿åˆ©ã§ã™ã€‚

:::message
å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å¤‰æ›´ã—ãŸå ´åˆã«ã¯ã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã‚ˆã† `index.html` ã®æ›´æ–°ã‚‚å¿…è¦ã§ã™ã€‚
:::

# ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰ã™ã‚‹

æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã®ãƒ“ãƒ«ãƒ‰ã¯ã€ãƒ¢ãƒ¼ãƒ‰ã« `production` ã‚’æŒ‡å®šã—ã€`serve` ã‚³ãƒãƒ³ãƒ‰ã‚’ **`build`** ã¸ç½®ãæ›ãˆã‚‹ã ã‘ã§ã™ã€‚

```sh:bash
npx webpack build --mode production
```

![](https://storage.googleapis.com/zenn-user-upload/30d284db7a99-20220502.png)

# NPM ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç™»éŒ²ã™ã‚‹

æ¯å›ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã¸é•·ã„ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã¡è¾¼ã‚€ã®ã‚‚ç–²ã‚Œã¦ããŸã®ã§ã€`package.json` ã® **`scripts`** ã¸ [NPM ã‚¹ã‚¯ãƒªãƒ—ãƒˆ](https://docs.npmjs.com/cli/v8/using-npm/scripts)ã‚’ç™»éŒ²ã—ã¾ã™ã€‚

https://docs.npmjs.com/cli/v8/using-npm/scripts

NPM ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ `npm run ã‚¹ã‚¯ãƒªãƒ—ãƒˆå` ã§å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```json:package.json
  "scripts": {
    "dev": "webpack serve --mode development",
    "build": "webpack build --mode production"
  },
```

```sh:bash
# é–‹ç™ºæ™‚
npm run dev

# ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰
npm run build
```

# NODE_ENV ã§å‡¦ç†ã‚’åˆ†å²ã™ã‚‹

ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—ã‚’ä½œæˆã™ã‚‹ã‹å¦ã‹ãªã©ã®å‡¦ç†ã‚’ç’°å¢ƒå¤‰æ•° `NODE_ENV` ã®å€¤ã«ã‚ˆã£ã¦åˆ†å²ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
Windows ã§ã¯ NPM ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ï¼‰ã«ç’°å¢ƒå¤‰æ•°ã‚’ä»˜åŠ ã™ã‚‹ã«ã¯ [cross-env](https://www.npmjs.com/package/cross-env) ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦ã§ã™ã€‚

```sh:bash
npm i -D cross-env
```

```json:package.json
  "scripts": {
    "dev": "cross-env NODE_ENV=\"development\" webpack serve",
    "build": "cross-env NODE_ENV=\"production\" webpack build"
  },
```

_â€» macOS ã‚„ Linux ã§ã¯ `cross-env` ã¯ä¸è¦_

`webpack.config.js` ã¸å‡¦ç†ã®åˆ†å²ã‚’æ›¸ãåŠ ãˆã¾ã™ã€‚

```js:webpack.config.js
// development ãƒ¢ãƒ¼ãƒ‰ã‹å¦ã‹ï¼Ÿ
const isDev = process.env.NODE_ENV === "development";

/** @type {import('webpack').Configuration} */
module.exports = {
  // ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆ
  mode: isDev ? "development" : "production",
  // dev ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—ã‚’ã¤ã‘ã‚‹
  devtool: isDev ? "source-map" : undefined,
  entry: "./src/index.jsx",
```

# CSSï¼ˆã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆï¼‰ã‚‚ãƒãƒ³ãƒ‰ãƒ«ã—ã¦ã¿ã‚‹

CSS ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ JS ã¸ãƒãƒ³ãƒ‰ãƒ«ã—ã¦ã—ã¾ã†ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/3364be5caa5a-20220502.png)

webpack ã§ CSS ã‚’ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹ã«ã¯ã€`style-loader` ã¨ `css-loader` ã® 2 ã¤ã®ãƒ­ãƒ¼ãƒ€ãƒ¼ãŒå¿…è¦ã§ã™ã€‚

- **`style-loader`:** `<link />` ã‚¿ã‚°ã¸ CSS ã‚’å±•é–‹ã—ã¾ã™ã€‚
- **`css-loader`:** CSS ã‚’ JS ã¸ãƒãƒ³ãƒ‰ãƒ«ã—ã¾ã™ã€‚

ãƒ­ãƒ¼ãƒ€ãƒ¼ã¯ `css-loader` -> `style-loader` ã®é †ã§é©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

https://github.com/webpack-contrib/style-loader#readme

https://github.com/webpack-contrib/css-loader#readme

## 1. ãƒ­ãƒ¼ãƒ€ãƒ¼ã®è¿½åŠ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```sh:bash
npm i -D style-loader css-loader
```

## 2. `module.rules` ã®è¿½åŠ 

CSS ç”¨ã®ãƒãƒ³ãƒ‰ãƒ«ãƒ«ãƒ¼ãƒ«ã‚’ `module.rules` é…åˆ—ã«è¿½åŠ ã—ã¾ã™ã€‚
è¤‡æ•°ã®ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚’é©ç”¨ã™ã‚‹å ´åˆã«ã¯ `loader` ã®ä»£ã‚ã‚Šã« **`use` é…åˆ—**ã‚’ç”¨ã„ã¾ã™ã€‚

```js:webpack.config.js
  module: {
    rules: [
      {
        test: /\.jsx?$/,
        loader: "babel-loader",
      },
      {
        // æ‹¡å¼µå­ css ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæ­£è¦è¡¨ç¾ï¼‰
        test: /\.css$/,
        use: ["style-loader", "css-loader"],
      },
    ],
  },
```

`use` é…åˆ—ã®ãƒ­ãƒ¼ãƒ€ãƒ¼ã¯**é…åˆ—ã®æœ€å¾Œå°¾ã‹ã‚‰é †ã«**é©ç”¨ã•ã‚Œã¾ã™ã€‚ã‚ˆã£ã¦ `css-loader` -> `style-loader` ã®é †ã¨ãªã‚Šã¾ã™ã€‚

## 3. ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®ç”¨æ„

é©å½“ãª CSS ã‚’ `styles.css` ã¸è¨˜è¿°ã—ã¦ã€ãã‚Œã‚’ `App.jsx` ã®ä¸­ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

```css:src/styles.css
body {
  margin: 0;
}

.container {
  height: 100vh;
  display: grid;
  place-content: center;
  place-items: center;
}
```

```diff jsx:src/App.jsx
  import React from "react";
+ import "./styles.css";

  export const App = () => {
```

## 4. devServer ã®èµ·å‹•

```sh:bash
npm run dev
```

![](https://storage.googleapis.com/zenn-user-upload/37b189134c82-20220502.png)
_ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆãŒé©ç”¨ã•ã‚ŒãŸ_

## 5. CSS ã«ã‚‚ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—ã‚’ä»˜ã‘ã‚‹

ãƒ‡ãƒãƒƒã‚°æ™‚ã«ã¯ãƒãƒ³ãƒ‰ãƒ«å‰ã® CSS ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—ã‚‚å¿…è¦ã§ã™ã€‚
`options` ã‚¨ãƒ³ãƒˆãƒªã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

https://github.com/webpack-contrib/css-loader#options

```js:webpack.config.js
      {
        test: /\.css$/,
        use: [
          "style-loader",
          {
            loader: "css-loader",
            options: {
              // dev ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—ã‚’ä»˜ã‘ã‚‹
              sourceMap: isDev,
            },
          },
        ],
      },
```

# Sass ã‚‚ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹

Sass ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹ã«ã¯ `sass` ã¨ `sass-loader` ã®è¿½åŠ ãŒå¿…è¦ã§ã™ã€‚

- **sass:** `sass(scss) -> css` ã®å¤‰æ›ã‚’è¡Œã„ã¾ã™ã€‚ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆç‰ˆ Babel ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚
- **sass-loader:** webpack ã« Sass ã‚’æ‰±ã‚ã›ã¾ã™ã€‚

```sh:bash
npm i -D sass sass-loader
```

ãƒ­ãƒ¼ãƒ€ãƒ¼ã®é©ç”¨é †ã¯ `sass-loader` -> `css-loader` -> `style-loader` ã¨ãªã‚Šã¾ã™ã€‚

```diff js:webpack.config.js
        {
+         // æ‹¡å¼µå­ scss ã¾ãŸã¯ css ã®ãƒ•ã‚¡ã‚¤ãƒ«
+         test: /\.s?css$/,
-         test: /\.css$/,
          use: [
            "style-loader",
            {
              loader: "css-loader",
              options: {
                sourceMap: isDev,
              },
            },
+           {
+             loader: "sass-loader",
+             options: {
+               sourceMap: isDev,
+             },
+           },
          ],
        },
```

ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã® CSS ã‚’ Sass(scss) ã¸å¤‰æ›ã—ã€å‰é …åŒæ§˜ã« `App.jsx` ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

```sass:src/styles.scss
body {
  margin: 0;

  .container {
    height: 100vh;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
  }
}
```

```diff jsx:src/App.jsx
- import "./styles.css";
+ import "./styles.scss";
```

![](https://storage.googleapis.com/zenn-user-upload/c6703e483330-20220502.png)

# ç”»åƒãªã©ã®ã‚¢ã‚»ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹

webpack v5.x ã§ã¯åˆ¥é€”ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚’å¿…è¦ã¨ã›ãšã« **JS ã‹ã‚‰èª­ã¿è¾¼ã¾ã‚Œã‚‹**ç”»åƒã‚„ãƒ•ã‚©ãƒ³ãƒˆãªã©ã®ã‚¢ã‚»ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒ³ãƒ‰ãƒ«ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

ã‚¢ã‚»ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒ³ãƒ‰ãƒ«ã«ã¯ `module.rules` ã§ **`type`** ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’ç”¨ã„ã¾ã™ã€‚

```js:webpack.config.js
  module: {
    rules: [
      {
        // ç”»åƒã‚„ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
        test: /\.(ico|png|svg|ttf|otf|eot|woff?2?)$/,
        type: "asset",
      },
```

:::details App.jsx ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§å±•é–‹ï¼‰

```jsx:App.jsx
import React from "react";

import reactLogo from "./react.svg";
import "./styles.scss";

export const App = () => {
  return (
    <div className="container">
      <img src={reactLogo} alt="logo" />
      <h1>Hello.</h1>
    </div>
  );
};
```

:::

![](https://storage.googleapis.com/zenn-user-upload/d664b8399478-20220502.png)
_React ã® react.svg ã‚’ãƒãƒ³ãƒ‰ãƒ«_

**type** ã®å€¤ã«ã¯ã„ãã¤ã‹ã®é¸æŠè‚¢ãŒã‚ã‚Šã¾ã™ãŒã€é€šå¸¸ã¯ä»¥ä¸‹ã® 3 ã¤ã‹ã‚‰é¸æŠã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

- **`asset/inline`:** ã‚¢ã‚»ãƒƒãƒˆã‚’ JS ãƒ•ã‚¡ã‚¤ãƒ«ã¸ãƒãƒ³ãƒ‰ãƒ«ã—ã¾ã™ã€‚
- **`asset/resource`:** ã‚¢ã‚»ãƒƒãƒˆã‚’åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›ã—ã¾ã™ã€‚
- **`asset`:** ã‚¢ã‚»ãƒƒãƒˆã‚’ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹ã‹ã€åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›ã™ã‚‹ã‹ã‚’è‡ªå‹•çš„ã«é¸æŠã—ã¾ã™ã€‚

ã‚¢ã‚»ãƒƒãƒˆã‚’ JS ãƒ•ã‚¡ã‚¤ãƒ«ã¸å«ã‚ã¦ã—ã¾ã†ã¨ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãããªã‚Šã™ãã‚‹ï¼ˆ=èª­ã¿è¾¼ã¿ã«æ™‚é–“ãŒã‹ã‹ã‚‹ï¼‰å ´åˆã®ãŸã‚ã«åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’é¸æŠã™ã‚‹ã‚±ãƒ¼ã‚¹ã«ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã‚’å¢—ã‚„ã—ã¦ã§ã‚‚ãƒãƒ³ãƒ‰ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚’æ—©ã‚ã‚‹ã»ã†ãŒãƒ¡ãƒªãƒƒãƒˆãŒå¤§ãã„å ´åˆãªã©ãŒè©²å½“ã™ã‚‹ã§ã—ã‚‡ã†ã€‚

## ã‚¢ã‚»ãƒƒãƒˆé¡ã®å‡ºåŠ›å…ˆã‚’è¨­å®šã™ã‚‹

`asset/resource` ã‚’é¸æŠã—ãŸå ´åˆã®ã‚¢ã‚»ãƒƒãƒˆé¡ã®å‡ºåŠ›å…ˆã‚‚ `output` ã‚¨ãƒ³ãƒˆãƒªã§ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã¯ **`assetModuleFilename`** ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

```js:webpack.config.js
  output: {
    filename: "[name].js",
    path: path.resolve(__dirname, "dist"),
    // "dist/asset/åå‰.æ‹¡å¼µå­" ã¨ã—ã¦å‡ºåŠ›ã•ã‚Œã‚‹
    assetModuleFilename: "asset/[name][ext]",
  },
```

ä¸Šã® `filename` ã‚¨ãƒ³ãƒˆãƒªã¨ã¯ç•°ãªã‚Šã€**ãƒ‰ãƒƒãƒˆ `.` ã¯ä¸è¦**ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/fc3650c940a0-20220502.png)

## ã‚¢ã‚»ãƒƒãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã«ã‚ˆã£ã¦ãƒãƒ³ãƒ‰ãƒ«ã®å¯å¦ã‚’åˆ†ã‘ã‚‹

ã‚¢ã‚»ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å®¹é‡ã«ã‚ˆã£ã¦è‡ªå‹•çš„ã« `asset/inline` ã¨ `asset/resource` ã‚’ã‚¢ã‚»ãƒƒãƒˆã”ã¨ã«ä½¿ã„åˆ†ã‘ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ã“ã‚Œã«ã¯ **`parser.dataUrlCondition.maxSize`** ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã„ã¾ã™ã€‚

```js:webpack.config.js
    rules: [
      {
        test: /\.(ico|png|svg|ttf|otf|eot|woff?2?)$/,
	// type ã¯è‡ªå‹•ãƒ¢ãƒ¼ãƒ‰
        type: "asset",
        parser: {
          dataUrlCondition: {
	    // 8kb ä»¥ä¸Šãªã‚‰ `asset/resource` ã™ã‚‹
            maxSize: 1024 * 8,
          },
        },
      },
```

# HTML ã‚‚ webpack ã‹ã‚‰å‡ºåŠ›ã™ã‚‹

ã“ã‚Œã¾ã§ã¯ `dist` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç½®ã„ãŸ HTML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ devServer ã§ã‚µãƒ¼ãƒ–ã—ã¦ã„ã¾ã—ãŸãŒã€ã“ã‚Œã‚‚ webpack ã‹ã‚‰å‡ºåŠ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

[html-webpack-plugin](https://github.com/jantimon/html-webpack-plugin) ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ã‚‡ã†ã€‚

https://github.com/jantimon/html-webpack-plugin#readme

```sh:bash
npm i -D html-webpack-plugin
```

html-webpack-plugin ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ `src/index.ejs` ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã€ãã‚Œã«ãƒãƒ³ãƒ‰ãƒ«æ¸ˆã¿ã® JS ã‚’ `<script> ~ </script>` ã‚¿ã‚°ã¨ã—ã¦å·®ã—è¾¼ã‚“ã  HTML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚

ã“ã‚Œä»¥å¤–ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãŸã¨ãˆã° `*.html` ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã—ãŸã„å ´åˆã«ã¯ `template` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¸æ˜ç¤ºçš„ã«ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```js:webpack.config.js
// ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®èª­ã¿è¾¼ã¿
const HtmlWebpackPlugin = require("html-webpack-plugin");

module.exports = {
  // "plugins" ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’è¿½åŠ 
  plugins: [
    // ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
    new HtmlWebpackPlugin({
      // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
      template: "./src/index.html",
      // <script> ~ </script> ã‚¿ã‚°ã®æŒ¿å…¥ä½ç½®
      inject: "body",
      // ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ã®ã‚¿ã‚¤ãƒ—
      scriptLoading: "defer",
      // ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ã‚‚ <link rel="shortcut icon" ~ /> ã¨ã—ã¦æŒ¿å…¥ã§ãã‚‹
      favicon: "./src/favicon.ico",
    }),
  ],
```

`index.html` ã‚’ `dist` ã‹ã‚‰ `src` ãƒ•ã‚©ãƒ«ãƒ€ã¸ç§»å‹•ã•ã›ã¾ã™ãŒã€`<script> ~ </script>` ã‚¿ã‚°ã‚„ `<link rel="shortcut icon" ~ />` ã‚¿ã‚°ã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒæŒ¿å…¥ã—ã¦ãã‚Œã‚‹ãŸã‚å‰Šé™¤ã—ã¾ã™ã€‚

```diff html:src/index.html
    <body>
      <div id="root"></div>
-     <script src="./main.js"></script>
    </body>
  </html>
```

ã“ã‚Œã«ã‚ˆã‚Šå‰å›ã®ãƒ“ãƒ«ãƒ‰çµæœã¯ `dist` ãƒ•ã‚©ãƒ«ãƒ€ã”ã¨å‰Šé™¤ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

# CSS ã‚‚åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›ã™ã‚‹

[CSP](https://developer.mozilla.org/ja/docs/Web/HTTP/CSP) (Content-Security-Policy) ã®è¨­å®šã«ã‚ˆã£ã¦ã¯ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã®ä½¿ç”¨ãŒç¦ã˜ã‚‰ã‚Œã¦ã„ã‚‹ã‚ˆã†ãªå ´åˆãŒã‚ã‚Šã¾ã™ã€‚

https://developer.mozilla.org/ja/docs/Web/HTTP/CSP

CSS ã‚’ JS ã¸ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹ã“ã¨ã¯ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã«è©²å½“ã™ã‚‹ãŸã‚ã€ã“ã‚Œã‚‚ã‚¢ã‚»ãƒƒãƒˆé¡ã¨åŒæ§˜ã«åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›ã—ãŸã„ã‚±ãƒ¼ã‚¹ãŒã‚ã‚‹ã§ã—ã‚‡ã†ã€‚

ã“ã‚Œã‚’å®Ÿç¾ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒ [mini-css-extract-plugin](https://github.com/webpack-contrib/mini-css-extract-plugin) ã§ã™ã€‚

https://github.com/webpack-contrib/mini-css-extract-plugin#readme

```sh:bash
npm i -D mini-css-extract-plugin
```

`webpack.config.js` ã§ mini-css-extract-plugin ã‚’èª­ã¿è¾¼ã¿ã€`style-loader` ã«ä»£ã‚ã£ã¦ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```js:webpack.config.js
// ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®èª­ã¿è¾¼ã¿
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
```

```diff js:webpack.config.js
        {
          test: /\.s?css$/,
          use: [
-           "style-loader",
+           MiniCssExtractPlugin.loader,
            {
              loader: "css-loader",
              options: {
                sourceMap: isDev,
              },
            },
```

**`plugins` é…åˆ—**ã«ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¦ãŠãã“ã¨ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„ã€‚

```diff js:webpack.config.js
    },
    plugins: [
+     new MiniCssExtractPlugin(),
      new HtmlWebpackPlugin({
        template: "./src/index.html",
        inject: "body",
        scriptLoading: "defer",
      }),
    ],
    devtool: isDev ? "source-map" : undefined,
    devServer: {
      static: {
        directory: "./dist",
      },
    },
  };
```

`dist` ãƒ•ã‚©ãƒ«ãƒ€ã¸ CSS ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚å‡ºåŠ›ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/4c0e79e81e58-20220502.png)

ä¸Šã® `html-webpack-plugin` ã‚’**åˆ©ç”¨ã—ãªã„**å ´åˆã€HTML ãƒ•ã‚¡ã‚¤ãƒ«ã¸æ‰‹å‹•ã§ `<link rel="stylesheet" ~ />` ã¨ã—ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```diff html:dist/index.html
    <head>
      <meta charset="UTF-8" />
      <title>Webpack</title>
+     <link rel="stylesheet" href="main.css" />
    </head>
```

é€†ã« `html-webpack-plugin` ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã«ã¯ã€è‡ªå‹•çš„ã« `<link rel="stylesheet" ~ />` ã‚¿ã‚°ãŒ HTML ã¸æŒ¿å…¥ã•ã‚Œã¾ã™ã€‚

# ã“ã“ã¾ã§ã® `webpack.config.js`

:::details webpack.config.jsï¼ˆã‚¯ãƒªãƒƒã‚¯ã§é–‹é–‰ï¼‰

```js:webpack.config.js
const path = require("node:path");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");

const isDev = process.env.NODE_ENV === "development";

/** @type {import('webpack').Configuration} */
module.exports = {
  mode: isDev ? "development" : "production",
  resolve: {
    extensions: [".js", ".json", ".jsx"],
  },
  entry: {
    main: "./src/index.jsx",
  },
  output: {
    filename: "[name].js",
    path: path.resolve(__dirname, "dist"),
    assetModuleFilename: "asset/[name][ext]",
  },
  module: {
    rules: [
      {
        test: /\.jsx?$/,
        loader: "babel-loader",
      },
      {
        test: /\.s?css$/,
        use: [
          MiniCssExtractPlugin.loader,
          {
            loader: "css-loader",
            options: {
              sourceMap: isDev,
            },
          },
          {
            loader: "sass-loader",
            options: {
              sourceMap: isDev,
            },
          },
        ],
      },
      {
        test: /\.(ico|png|svg|ttf|otf|eot|woff?2?)$/,
        type: "asset/resource",
      },
    ],
  },
  plugins: [
    new MiniCssExtractPlugin(),
    new HtmlWebpackPlugin({
      template: "./src/index.html",
      inject: "body",
      scriptLoading: "defer",
    }),
  ],
  devtool: isDev ? "source-map" : undefined,
  devServer: {
    static: {
      directory: "./dist",
    },
  },
};
```

:::

# TypeScript ã‚’ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹

## 1. å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

- TypeScript æœ¬ä½“

```sh:bash
npm i -D typescript
```

- ãƒ­ãƒ¼ãƒ€ãƒ¼

```sh:bash
npm i -D ts-loader
```

## 2. `tsconfig.json` ã®ä½œæˆ

TypeScript ã®æŒ™å‹•ã‚’è¦å®šã™ã‚‹ `tsconfig.json` ã‚’ä½œæˆã—ã¾ã™ã€‚
ã¾ãŸã€React ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã«ã¯ `"jsx": "react"` ã®è¿½è¨˜ã‚‚å¿…è¦ã§ã™ã€‚

```sh:bash
npx tsc --init
```

![](https://storage.googleapis.com/zenn-user-upload/4a45a689561c-20220502.png)

```json:tsconfig.jsonï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã¯å‰Šé™¤ï¼‰
{
  "compilerOptions": {
    "target": "es2016",
    "module": "commonjs",
    "esModuleInterop": true,
    "forceConsistentCasingInFileNames": true,
    "strict": true,
    "skipLibCheck": true,
    "jsx": "react"
  }
}
```

## 3. `webpack.config.js` ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

TS ã®ãƒãƒ³ãƒ‰ãƒ«ã«ã¯ babel-loader ã®ä»£ã‚ã‚Šã« [ts-loader](https://www.npmjs.com/package/ts-loader) ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

:::message
å¤ã„ãƒ–ãƒ©ã‚¦ã‚¶ã¸ã®å¯¾å¿œãªã©ã®ç†ç”±ã§ `babel-loader` ã¨ `ts-loader` ã‚’ä½µç”¨ã™ã‚‹ã‚±ãƒ¼ã‚¹ã‚‚ã‚ã‚Šã¾ã™ã€‚
:::

ï¼ˆå¤‰æ›´éƒ¨åˆ†ã®ã¿ã‚’æŠœç²‹ï¼‰

```js:webpack.config.js
module.exports = {
  entry: {
    // "tsx" ã¸å¤‰æ›´
    main: "./src/index.tsx",
  },
  resolve: {
    // TS ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ 
    extensions: [".js", ".jsx", ".ts", ".tsx"],
  },
  module: {
    rules: [
      {
        // "tsx" ã¸å¤‰æ›´
        test: /\.tsx?$/,
        // "babel-loader" -> "ts-loader"
        loader: "ts-loader",
      },
    ],
  },
};
```

# `webpack.config` ã‚’ TypeScript ã§è¨˜è¿°ã™ã‚‹

`webpack.config.js` ã®æ‹¡å¼µå­ã‚’ **`ts`** ã¸å¤‰æ›´ã™ã‚‹ã«ã¯ä»¥ä¸‹ã® 2 ã¤ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå¿…è¦ã§ã™ã€‚

- **[ts-node](https://github.com/TypeStrong/ts-node)**: TypeScript ã®ã¾ã¾ Node.js ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
- **[@types/node](https://www.npmjs.com/package/@types/node)**: TypeScript ç”¨ Node.js ã®å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«

```bash:sh
npm i -D ts-node @types/node
```

ã¾ãŸã€`tsconfig.json` ã® `ts-node` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ **`"module": "CommonJS"`** ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```json:tsconfig.jsonã®ä¾‹
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "ES2020",
    "moduleResolution": "Node",
    "esModuleInterop": true,
    "strict": true,
    "jsx": "react"
  },
  "ts-node": {
    "compilerOptions": {
      "module": "CommonJS"
    }
  }
}
```

:::details webpack.config.ts ã®ä¾‹

```ts:webpack.config.ts
// require æ–‡ã‹ã‚‰ import æ–‡ã¸
import path from "node:path";
import HtmlWebpackPlugin from "html-webpack-plugin";
import MiniCssExtractPlugin from "mini-css-extract-plugin";

/** ä»¥ä¸‹ 2 è¡Œã¯è£œå®Œã‚’åŠ¹ã‹ã›ã‚‹ãŸã‚ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ */
import "webpack-dev-server";
import { Configuration } from "webpack";

const isDev = process.env.NODE_ENV === "development";

const config: Configuration = {
  mode: isDev ? "development" : "production",
  resolve: {
    extensions: [".js", ".jsx", ".ts", ".tsx", ".json"],
  },
  entry: {
    main: "./src/index.tsx",
  },
  output: {
    filename: "[name].js",
    path: path.resolve(__dirname, "dist"),
    assetModuleFilename: "asset/[name][ext]",
  },
  module: {
    rules: [
      {
        test: /\.tsx?$/,
        loader: "ts-loader",
      },
      {
        test: /\.s?css$/,
        use: [
          MiniCssExtractPlugin.loader,
          {
            loader: "css-loader",
            options: {
              sourceMap: isDev,
              importLoaders: 1,
            },
          },
          {
            loader: "sass-loader",
            options: {
              sourceMap: isDev,
            },
          },
        ],
      },
      {
        test: /\.(ico|png|svg|ttf|otf|eot|woff?2?)$/,
        type: "asset/resource",
      },
    ],
  },
  plugins: [
    new MiniCssExtractPlugin(),
    new HtmlWebpackPlugin({
      template: "./src/index.html",
      inject: "body",
      scriptLoading: "defer",
    }),
  ],
  devtool: isDev ? "inline-source-map" : undefined,
  devServer: {
    static: {
      directory: "./dist",
    },
  },
};

// è¨­å®šã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
export default config;
```

:::

# å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

https://webpack.js.org/concepts/
