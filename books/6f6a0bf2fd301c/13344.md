---
title: "ã‚»ã‚­ãƒ¥ã‚¢ãª IPC é€šä¿¡ï¼ˆcontextBridge ç·¨ï¼‰"
free: true
---

å‰ç« ã¾ã§ã§ `nodeIntegration: false` ãª IPC é€šä¿¡ãŒå®Ÿç¾ã§ãã¾ã—ãŸã€‚ã§ã¯ã€ã‚‚ã† 1 ã¤ã®**ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®åˆ†é›¢**ã«é–¢ã™ã‚‹å•é¡Œã®è§£æ±ºã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€‚

# `contextBridge` ã®å°å…¥

Electron ã«ã¯ã€[`contextBridge`](https://www.electronjs.org/ja/docs/latest/api/context-bridge) ã¨ã„ã† API ã‚‚ç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€preload ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã§åˆ†é›¢ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆé–“ã®ãƒ–ãƒªãƒƒã‚¸ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

https://www.electronjs.org/ja/docs/latest/api/context-bridge

ã“ã“ã§ã‚‚ **ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã®ãŸã‚ã«é–‹ã‘ã‚‰ã‚ŒãŸå°çª“**ã¨ã„ã†æ€§è³ªã«å¤‰ã‚ã‚Šã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

## `contextBridge` ã®æ§‹æ–‡

```javascript:æ§‹æ–‡
contextBridge.exposeInMainWorld(
  'ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã«è¦‹ã›ã‚‹ API ã‚­ãƒ¼å',
  {
    // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã«åˆ©ç”¨ã•ã›ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
    doThing: () => ipcRenderer.send('do-a-thing')
  }
)
```

ã“ã‚Œã«ã‚ˆã‚Šãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰ã¯ã€**`'API ã‚­ãƒ¼'.doThing()`** ã¨ã„ã†ã‹ãŸã¡ã§ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã®æ©Ÿèƒ½ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## `contextBridge` ã®ç”¨æ³•ã«ã¯æ³¨æ„ãŒå¿…è¦

ãŸã ã—ã€`contextBridge` API ã®ç”¨æ³•ã«ã¯æ³¨æ„ãŒå¿…è¦ãªç‚¹ã‚‚ã‚ã‚Šã¾ã™ã€‚ãŸã¨ãˆã°ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã€`contextBridge` ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã«ã‚‚ã‹ã‹ã‚ã‚‰ãš**å±é™º**ã§ã™ã€‚

```javascript:preload.js
const { ipcRenderer, contextBridge } = require('electron');

contextBridge.exposeInMainWorld('myAPI', {
  // ğŸ†– bad!
   renderer: ipcRenderer
});
```

ãªãœãªã‚‰ã€ã“ã® `myAPI.renderer()` ã¯ `ipcRenderer` ã¨ã„ã†å¼·åŠ›ãª API ã‚’**ç„¡åˆ¶é™ã‹ã¤åŒ…æ‹¬çš„ã«**ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã¸æ›ã—ã¦ã—ã¾ã£ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚

[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://www.electronjs.org/ja/docs/latest/tutorial/context-isolation)ã‚ˆã‚Šå¼•ç”¨ã—ã¾ã™:

> ã“ã‚Œã¯ã€å¼·åŠ›ãª API ã‚’å¼•æ•°ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãªã—ã§ç›´æ¥å…¬é–‹ã™ã‚‹ã‚‚ã®ã§ã™ã€‚ã“ã‚Œã§ã¯ã€ä»»æ„ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆãŒã€å¯èƒ½ã§ã‚ã£ã¦ã»ã—ããªã„ä»»æ„ã® IPC ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã¦ã—ã¾ã„ã¾ã™ã€‚

> IPC ãƒ™ãƒ¼ã‚¹ã® API ã‚’å…¬é–‹ã™ã‚‹æ­£ã—ã„æ–¹æ³•ã¯ã€ä»£ã‚ã‚Šã« IPC ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã”ã¨ã« 1 ã¤ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›ã™ã‚‹ã“ã¨ã§ã™ã€‚

ã€ŒIPC ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆã®ãƒãƒ£ãƒ³ãƒãƒ«ï¼‰ã”ã¨ã« 1 ã¤ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›ã™ã‚‹ã€ã‚ˆã†ã«æ›¸ãç›´ã™ã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```javascript:preload.js
const { ipcRenderer, contextBridge } = require('electron');

contextBridge.exposeInMainWorld('myAPI', {
  openDialog: () => ipcRenderer.invoke('open-dialog'),
});
```

ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ãŒ `myAPI.openDialog()` ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã¨ã€`open-dialog` ãƒãƒ£ãƒ³ãƒãƒ«ã®**ç¯„å›²ã§ã®ã¿**ã“ã®ãƒ–ãƒªãƒƒã‚¸ã‚’æ¸¡ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

# ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆ`app.js`ï¼‰ã®ä¿®æ­£

ãã‚Œã§ã¯ã€`contextBridge` ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’å‰æã« `app.js` ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

```javascript:app.js
const button = document.getElementById('button');
const text = document.getElementById('text');

button.addEventListener('click', async () => {
  /**
   * Window ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã« openDialog() ãƒ¡ã‚½ãƒƒãƒ‰ã¯ **ã‚‚ã†** å­˜åœ¨ã—ã¦ã„ãªã„ï¼
   * text.textContent = await window.openDialog();
   */

  // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã«è¦‹ãˆã¦ã„ã‚‹ã®ã¯ myAPI ã‚­ãƒ¼ã®ã¿ã§ã€ãã‚Œä»¥å¤–ã®ã“ã¨ã¯åˆ†ã‹ã‚‰ãªã„
  text.textContent = await window.myAPI.openDialog();
});
```

# ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã‚‚ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

ã¤ã„ã« `nodeIntegration: false` ã‹ã¤ `contextIsolation: true` ãª IPC é€šä¿¡ãŒå®Ÿç¾ã§ãã¾ã—ãŸã€‚

```diff javascript:main.js
  const createWindow = () => {
    const mainWindow = new BrowserWindow({
      width: 600,
      height: 400,
      title: 'ãƒã‚¤ã‚¢ãƒ—ãƒª',
      webPreferences: {
-       contextIsolation: false,
        preload: path.join(__dirname, 'preload.js'),
      },
    });
    // çœç•¥
  };
```

# ã“ã®ç« ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å…¨æ–‡

```html:index.html
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ãƒã‚¤ã‚¢ãƒ—ãƒª</title>
  </head>
  <body>
    <h1>Hello, world.</h1>
    <button id="button">Open</button>
    <p id="text"></p>

    <script src="app.js"></script>
  </body>
</html>
```

```javascript:main.js
const { app, BrowserWindow, ipcMain, dialog } = require('electron');
const path = require('path');

const createWindow = () => {
  const mainWindow = new BrowserWindow({
    width: 600,
    height: 400,
    title: 'ãƒã‚¤ã‚¢ãƒ—ãƒª',
    webPreferences: {
      // nodeIntegration: true,
      // contextIsolation: false,
      preload: path.join(__dirname, 'preload.js'),
    },
  });

  ipcMain.handle('open-dialog', async (_e, _arg) => {
    return dialog
      .showOpenDialog(mainWindow, {
        properties: ['openFile'],
      })
      .then((result) => {
        if (result.canceled) return '';
        return result.filePaths[0];
      });
  });

  mainWindow.loadFile('index.html');
};

app.once('ready', () => {
  createWindow();
});

app.once('window-all-closed', () => app.quit());
```

```javascript:preload.js
const { ipcRenderer, contextBridge } = require('electron');

contextBridge.exposeInMainWorld('myAPI', {
  openDialog: () => ipcRenderer.invoke('open-dialog'),
});
```

```javascript:app.js
// const { ipcRenderer } = require('electron');

const button = document.getElementById('button');
const text = document.getElementById('text');

button.addEventListener('click', async () => {
  /**
   * Window ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã« openDialog() ãƒ¡ã‚½ãƒƒãƒ‰ã¯ **ã‚‚ã†** å­˜åœ¨ã—ã¦ã„ãªã„ï¼
   * text.textContent = await window.openDialog();
   */

  // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã«è¦‹ãˆã¦ã„ã‚‹ã®ã¯ myAPI ã‚­ãƒ¼ã®ã¿ã§ã€ãã‚Œä»¥å¤–ã®ã“ã¨ã¯åˆ†ã‹ã‚‰ãªã„
  text.textContent = await window.myAPI.openDialog();
});
```
